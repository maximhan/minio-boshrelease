---
name: minio-server
templates:
  ctl.erb: bin/ctl
  health_check.erb: bin/health_check
  health_check.erb: bin/dns/healthy
  dns/aliases.json.erb: dns/aliases.json
  public.crt.erb: config/public.crt
  private.key.erb: config/private.key
  ca.crt.erb: config/ca.crt
  kes-ca.crt.erb: config/kes-ca.crt
  kes-root_identity.crt.erb: config/root.crt
  kes-root_identity.key.erb: config/root.key

packages:
- minio

consumes:
- name: minio-server
  type: server

provides:
- name: minio-server
  type: server
  properties:
  - port
  - credential.accesskey
  - credential.secretkey
  - server_cert
  - ca_cert
- name: http_backend
  type: http-router
  properties:
  - port

properties:
  licensekey:
    descrption: "License Key"
  credential.accesskey:
    description: "The access key the server should accept"
    default: ~
  credential.secretkey:
    description: "The secret key the server should accept"
    default: ~
  port:
    description: "The port on which the Minio server should bind"
    default: 9000
  envs:
    description: "environmental variable settings for MinIO process"
    default: ""
    example: |
      export MINIO_STORAGE_CLASS_STANDARD=EC:2
      export MINIO_BROWSER=off
  pcf_tile_version:
    description: "PCF Tile version"
    default: ""
  server_cert:
    description: |
      PEM-encoded certificate for the Minio server. When set, nodes will communicate with each other over HTTPS rather than HTTP.
      See 'dns_alias' property below for hostname information.
    default: ~
  server_key:
    description: |
      PEM-encoded private key for the Minio server.
    default: ~
  ca_cert:
    description: |
      PEM-encoded certificate used to sign the certificates of the other Minio nodes.
      Required if `server_cert` is specified and `server_cert` was signed by a third-party CA.
    default: ~
  dns_alias:
    description: |
      When set, the nodes in the minio cluster will communicate with each other using '$NODE_ID.$DNS_ALIAS' as the hostname.
      HTTPS certs should use this domain as the Common Name plus a wildcard Subject Alt Name, e.g. 'minio-server.service.cf.internal' and '*.minio-server.service.cf.internal'.
      This is a temporary workaround until BOSH DNS supports autogenerated certs for BOSH DNS records.
    example: "minio-server.service.cf.internal"
    default: ~
  kes.endpoint:
    description: "KES Server endpoint"
    example: "https://play.min.io:7373"
  kes.ca_cert:
    description: "The TLS root certificates used by MinIO to verify the certificate presented by to the KES Server when establishing a TLS connection"
    example: |
      -----BEGIN CERTIFICATE-----
      ...
      -----END CERTIFICATE-----
  kes.key_name:
    description: "The (default) key at the KES Server"
    default: "minio-key"
  kes.root_identity_cert:
    description: The root identity certificate (public key)
    example: |
      -----BEGIN CERTIFICATE-----
      ...
      -----END CERTIFICATE-----
  kes.root_identity_key:
    description: The root identity key (private key)
    example: |
      -----BEGIN PRIVATE KEY-----
      ...
      -----END PRIVATE KEY-----
